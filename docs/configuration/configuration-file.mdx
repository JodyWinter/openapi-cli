import { JsonSchema } from '@redocly/developer-portal/ui';
import Schema from './schema.yaml';
import { StyledContent } from '../../components/styled.elements';


# Redocly configuration file

The Redocly configuration file is used by OpenAPI CLI and other Redocly apps to control their behavior — from the strictness of the `lint` command, to how Redocly renders your docs.

* Workflows uses it in the API registry to manage your APIs and control advanced features like region and link resolution.
* Reference uses it to apply your custom settings when it's building API reference documentation (hosted and on-premise).
* VS Code extension uses it for linting criteria, to apply custom settings for live documentation previews, and to set API definition root files.

## File name, location and format

The Redocly configuration file must be named either `redocly.yaml` or `.redocly.yaml`. It must be located in the root of your project directory, and it must be in the YAML format. If you cloned the `openapi-starter` project, this is already set up for you.

:::warning
If you have a `redocly.yaml` and a `.redocly.yaml` file  in the same directory, Redocly apps will show a warning in the output and ask you to choose one file.
:::

## File structure
The Redocly configuration file consists of several sections, each with its own configuration options. Here's an example:

```yaml
organization:
# The organization ID of a Redocly Workflows organization.
# Used for easier integration with the API registry and hosted Reference docs,
# not required for local OpenAPI CLI usage.
apis:
# A collection of objects, each representing one API.
# An API should be defined by a name, an optional version,
# and the path to the root OpenAPI document.
# Additionally, each API can have its own lint and features.openapi
# sections for fine-grained control.
# Example:
  main:
    root: ./openapi/openapi.yaml
    lint:
      rules:
        example-rule: warn
  external@v1:
    root: ./openapi/external.yaml
    labels:
      - external
    features.openapi:
      hideLogo: true

lint:
# Global configuration for the lint command.

features.mockServer:
# Configuration for the optional mock server feature in the API registry.
# Available in Pro and Enterprise plans only.

region: eu
# Configuration for optional AWS region selection when logging into Redocly services.

resolve:
# Configuration for resolving external links in your definition that are not publicly accessible.
# Not required for Redocly API registry links.

features.openapi:
# The API reference docs options, including theme options.
```

**INSERT SCHEMA.YAML HERE**

## `organization`

The `organization` section stores your Redocly Workflows organization ID that the `push` command uses to push API definition files to the API registry. If an organization ID is not passed explicitly in command-line arguments, `push` will look for it in `redocly.yaml`.

The `organization` property is only required in the configuration file if you're using the API registry and/or hosted Reference docs. It is not required for local OpenAPI CLI usage.

To find the organization ID:

1. Log into Workflows.
2. Access the **API registry** page.
3. In your browser's address bar, find the page URL.
4. The segment after `app.redocly.com/org/` is the organization ID.

For example, if the URL is `app.redocly.com/org/test_docs`, the organization ID is `test_docs`.

```yaml
organization: test_docs
apis:
  main@v1:
    root: ./openapi/openapi.yaml
...
```

:::info
In Redocly Workflows, organization ID and organization name are not the same thing.
:::

## `apis`

### Overview

The `apis` section lets you configure one or more API definition files. This gives you the flexibility to reference specific files in commands, and configure each file at a granular level.

Every file listed in this section is identified by `name@version`. `@version` is optional. It allows you to manage multiple versions of each API. When a version is not provided, Redocly apps interpret a file as being `latest`. Every `name@version` combination must be unique.

For every OpenAPI definition listed in the `apis` section, use the `root` property to define the path to the file. For example:

```yaml
apis:
  main@v1:
    root: ./openapi/openapi.yaml
    labels:
      - main
    lint: []
    features.openapi: []
```

### Impact on commands

You can pass `name` or `name@version` in commands like `lint` and `stats` to act only on the OpenAPI definition files you specify.

Bonus: You only need to type `name` or `name@version` in commands, not the entire path to the file. No one's getting any younger — especially not us. Where we can save you time, we will!

### Examples

```yaml
apis:
  main:
    root: ./openapi.yaml
    labels:
      - main
    lint: []
    features.openapi: []
  production:
    root: ./production.yaml
    labels:
      - production
    lint: []
    features.openapi: []
  sandbox:
    root: ./sandbox.yaml
    labels:
      - sandbox
    lint: {}
    features.openapi: {}
```

Given the configuration above and the following command, `./production.yaml` is validated because it's the only one currently using the name `production`:

```shell
openapi lint production
```

If you run `lint` without specifying a name, all API definitions listed in the `apis` section will get validated:

```shell
openapi lint
```

### Optional properties supported by the `apis` section
The `apis` section supports several optional properties for each API.

#### The `labels` property
Use `labels` to assign one or more existing Redocly Workflows organization-wide labels to your APIs. You must have a Redocly Workflows account with an active organization, and the top-level `organization` property must be added to `redocly.yaml`.

```yaml
apis:
  main:
    root: ./openapi/openapi.yaml
    labels:
      - main
```

:::info
If you try to assign labels that don't already exist for your organization, Redocly apps will show a warning in the output and will only assign existing labels.
:::

#### The `lint` property
In addition to the global (top-level) `lint` section, you can define lint rules for each API listed in the `apis` section.

```yaml
apis:
  main:
    root: ./openapi/openapi.yaml
    labels:
      - main
    lint:
      rules:
        example-rule: warn
```

Not all `lint` options are supported for individual APIs.

Option | Per-API support | Behavior
-- | -- | --
lint.extends | ❗ | API settings override global settings.
lint.rules | ✅ | API and global settings merge. In case of conflict, API takes priority.
lint.decorators | ✅ | API and global settings merge. In case of conflict, API takes priority.
lint.preprocessors | ✅ | API and global settings merge. In case of conflict, API takes priority.
lint.plugins | ❌ | Available in global configuration only.

#### The `features.openapi` property
The global (top-level) `features.openapi` section is where you configure how all of your published reference docs will look (style, fonts, colors — known as *theming*) and behave (enable/disable search, show/hide API reference docs download option — known as *functionality*).

If you need to apply different theming and functionality to individual APIs, add the `features.openapi` property to the `apis` section, and use the same options as the global `features.openapi`.

Option | Per-API support | Behavior
-- | -- | --
features.openapi | ✅ | API and global settings merge. In case of conflict, API takes priority.

#### The `features.mockServer` property
You can apply `features.mockServer` to individual APIs as well as at the global level.

Option | Per-API support | Behavior
-- | -- | --
features.mockServer | ✅ | API and global settings merge. In case of conflict, API takes priority.

## `lint`

### Overview
The `lint` section lets you set rules that control how the `lint` and `bundle` commands behave.

You can set global (top-level) rules for all APIs, or specific rules for each API listed in the `apis` section. If `lint` rules are defined for individual APIs, their settings apply *together* with the global configuration. So, if API and global sections modify the same properties, API settings will always override global settings.

The `lint` section is divided into smaller subsections, each defining different configuration options. Here's an example showing the `plugins`, `extends` and `rules` subsections:

```yaml
lint:
  plugins:
    - './local-plugin.js'
  extends:
    - recommended
  rules:
    no-sibling-refs:
      severity: error
    boolean-parameter-prefixes:
      severity: error
      prefixes: ['should', 'is', 'has']
  ...
```

Each subsection is described below. All are optional, so only add them to the `lint` section if needed.

:::info
The `rules` and `decorators` subsections only work at the API level. The `plugins` subsection only works at the global level.
:::

#### The `plugins` subsection

Used to import custom local plugins. Type is `string`.

:::warning
Community plugins are not supported, and you don't need to import built-in plugins and rules.
:::

Here are some examples:

```yaml Import a single plugin
lint:
  plugins:
    - './local-plugin.js'
```

```yaml Import multiple plugins
lint:
  plugins: 
    - './local-plugin.js',
    - './another-local-plugin.js'
```

#### The `extends` subsection

OpenAPI CLI comes with [built-in rules](./resources/built-in-rules.md) that are used to validate API definitions. In the Redocly configuration file, you can apply and configure each built-in rule per definition, or you can use **rule sets** to invoke a lot of rules at the same time.

OpenAPI CLI has three rule sets — each specifying different levels of severity — that can be applied via the `--extends` option in the `lint` command.

The `extends` subsection in the Redocly configuration file lets you configure rule sets and further extensions, and also lets you add your own plugins. You can use subsequent subsections to override specific settings if you wish.

`all`, `minimal` and `recommended` can only be used with built-in rules. For custom plugins, additional configuration can be applied (our [guide to custom plugins and rules](../resources/custom-rules.md#configs-in-plugins) has more information).

Here are some examples of `extends`:

```yaml
lint:
  extends:
    - recommended
    - sample/my-custom-rule-set
```

```yaml Single rule set
lint:
  extends:
    - minimal
```

```yaml Multiple rule sets
lint:
  extends:
    - minimal
    - recommended
```

If there is a conflict where multiple rule sets are used, the rule set at the bottom of the list will take priority.

#### The `preprocessors` subsection

Changes the severity level of any preprocessors in your extended configurations. Preprocessors run first during the `lint` and `bundle` commands. For `bundle`, linting only happens if the `--lint` option is used in the command.

#### The `rules` subsection

`rules` lets you change the [severity level](#severity-levels) of any rule in your extended linting configurations. Some rules can also support [additional options](#additional-rule-options).

:::info
When running the `lint` command, rules run *after* preprocessors. For the `bundle` command, rules run *between* preprocessors and decorators.
:::

In this example, we can see how we might use the `rules` subsection to influence `lint` when it encounters the `info-contact` built-in rule:

```yaml Short syntax
lint:
  rules:
    info-contact: error
```

```yaml Verbose syntax
lint:
  rules:
    info-contact:
      severity: error
```

```yaml Rules with additional configuration
# Use verbose configuration syntax to define additional configuration
# The boolean-parameter-prefixes example overrides the default "prefixes".
lint:
  rules:
    boolean-parameter-prefixes:
      severity: error
      prefixes: ['should', 'is', 'has']
```

#### The `decorators` subsection

A 'decorator' is a programming pattern that modifies the bundling process after validation has completed. This subsection of `lint` is used to enable and disable decorators if these are in use.

:::info
When running the `bundle` command, decorators *after* linting and linting only happen if the `--lint` option is used in the command.
:::

### Severity levels

As we have seen, severity levels can be added to  [`preprocessors`](#preprocessors), [`rules`](#rules) and [`decorators`](#decorators) with these values:
* `error`
* `warn`
* `off`

If using the short syntax, you won't be able to configure the [additional rule option](#additional-rule-options) for a rule — even if that rule supports it.

```yaml Short syntax
lint:
  extends:
    - recommended
  rules:
    boolean-parameter-prefixes: warn
    no-unused-components: error
```

```yaml Verbose syntax
lint:
  extends:
    - recommended
  rules:
    boolean-parameter-prefixes:
      severity: warn
    no-unused-components:
      severity: error
```

:::info
See our [built-in rules documentation](../resources/built-in-rules.md) for more information about the built-in rules available in OpenAPI CLI.
:::

### The additional rules option

Some [built-in rules](../resources/built-in-rules.md) support additional configuration via the additional rule object. The object is like:

Property | Type | Description
---|---|---
`severity` | `string` | REQUIRED. Possible values: `error`, `warn`, `off`.
`additionalProperties` | `string` | Different rules may have additional configuration options. Additional property names and values are documented with each rule.

Here's an example of an additional rule applied to `boolean-parameter-prefixes`:
    
Property | Type | Description
---|---|---
`severity` | `string` | REQUIRED. Possible values: `error`, `warn`, `off`.
`prefixes` | `[string]` | A list of boolean prefix strings. Each boolean property must have one of these strings as its initial characters. Possible values: `can`, `has`, `is`, `should`. Default values: `has`, `is`.

```yaml
lint:
  extends:
    - recommended
  rules:
    boolean-parameter-prefixes:
      severity: warn
      prefixes: ["can", "has", "is", "should"]
    no-unused-components:
      severity: error
```

:::success Tip
If you write custom rules, you can make it so they accept the additional rules option. Just be sure to document them!
:::

### Different OpenAPI versions and `lint`

Redocly OpenAPI CLI supports OpenAPI Specification versions 2.0, 3.0, and 3.1. Most of the time you will use one of them, but sometimes you may need to configure different rules based on the OpenAPI Specification version your definition is written in. You can do that by using additional configuration sections.

In this example:
* If version 2 (formerly known as Swagger) then `lint` will prioritize the `oas2Rules` subsection.
* If version 3 (OpenAPI 3.x) then `lint` will prioritize the `oas3_0Rules` subsection.
* If no version is defined then `lint` will fall back to the `rules` subsection.

```yaml
lint:
  extends:
    - recommended
  rules:
    boolean-parameter-prefixes: warn
    no-unused-components: error
  oas2Rules:
    no-unused-components: off
  oas3_0Rules:
    boolean-parameter-prefixes: error
```

See our [built-in rules documentation](../resources/built-in-rules.md) for more information about the built-in rules available in OpenAPI CLI.

### Resolve JSON references ($refs) — or not

The OpenAPI Specification supports `$refs` in several objects to enable content re-use and make longer API definitions easier to deal with. Different tools and implementations of the specification — as well as the human beings who write the actual definitions — may use or require `$refs` in unsupported places.

Starting from version `beta-30`, OpenAPI CLI automatically resolves all `$refs` by default — even in those dark, dusty corners where the OpenAPI Specification does not allow them. This includes primitive values, for example `string`, in description and example fields.

You can stop `lint` from resolving `$refs` in examples by adding the `doNotResolveExamples` configuration option in the `lint` section of the Redocly configuration file. This does not affect `$ref` resolution in other parts of the API definition:

```yaml
lint:
  doNotResolveExamples: true
  extends:
    - recommended
  rules:
    (...)
```

## features.mockServer
A mock server imitates a real API server by providing mock API responses to requests. The API registry supports [mock servers](../../api-registry/guides/mock-server-quickstart.md) that let you send test requests to your APIs from any API client.

In `redocly.yaml`, the optional `features.mockServer` section lets you configure how the mock server behaves.

## region

For optimized performance or for compliance reasons, you can specify which region to use when logging into Redocly services such as the API registry. Supported regions are `us` (default) and `eu` (available only to enterprise customers).

You should log into the region that corresponds to your Redocly Workflows organization. If you're a member of multiple organizations in different regions, it's technically possible to log into two different regions at the same time, but it's neither the most common nor the recommended use-case.

Every supported region uses its own domain.

Region | Domain
-----|----------
`us` | api.redoc.ly
`eu` | api.eu.redocly.com

To configure which domain will be used, you can use any of the following.

The `REDOCLY_DOMAIN` environment variable:

```sh
export REDOCLY_DOMAIN={domain}
```

The `--region` option with the `login` and `push` commands:

```sh
openapi login --region=eu
```

The `region` top-level section in the Redocly configuration file:

```yaml
apis:
  main:
    root: ./openapi.yaml
region: eu
lint:
  extends: []
```

## resolve

All API registry links and public URLs in your API definitions will automatically resolve. If you want to resolve links that are neither API registry links nor publicly accessible, you must add the `resolve` section to `redocly.yaml`.

:::info
The `resolve` command only supports `http` headers, and only one `http` header per URL is supported under the `resolve` section. We recommend using environment variables whenever possible.
:::

The `resolve` section should be structured like this:

```yaml
resolve:
  http:
    headers:
      - # header configuration
```

See the [schema](#file-structure) for properties supported by the `headers` object.

Here is an example of adding header definitions to `resolve`:

```yaml
resolve:
  http:
    headers:
      - matches: https://api.example.com/v2/**
        name: X-API-KEY
        envVariable: SECRET_KEY
      - matches: https://example.com/*/test.yaml
        name: Authorization
        envVariable: SECRET_AUTH
```

If the URL matches multiple patterns, the first match takes precedence. Therefore, only the header from the first match will be used in the request.

## features.openapi

The `features.openapi` section is where you configure how your published reference docs will look (style, fonts, colors — known as _theming_) and behave (enable/disable search, show/hide API reference docs download option  — known as _functionality_).

Three products are impacted by this section: Redoc Community Edition (CE), Redocly reference and the Developer portal (if the API catalog feature is used). Reference supports all configuration options from Redoc Community Edition plus a set of premium options.

Find the full list of supported options on the [Reference docs configuration page](../../api-reference-docs/configuration/index.mdx).